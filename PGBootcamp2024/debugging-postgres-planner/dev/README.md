# Инструментарий отладки

В этой директории находятся скрипты автоматизации разработки и отладки PostgreSQL:

- `setup.sh` - настройка окружения для разработки: запуск `./configure`,
    создание файлов конфигурации и др. Он запускается 1 раз, перед началом
    разработки.
- `build.sh` - скрипт для запуска сборки
- `run.sh` - скрипт для управления БД и запуска PSQL
- `test.sh` - запуск тестов
- `clean.sh` - очистка репозитория после работы

> Также имеются инфраструктурные скрипты: `get_current_backend_pid.sh`,
> `utils.sh`.

У каждого есть опции `-h`/`--help` для отображения информации по каждому.

Эти скрипты должны лежать в директории `dev` в корне проекта (корень исходников
PostgreSQL).

> Эти скрипты можно объединить с VS Code с помощью тасок.
> В директории `.vscode` (выше) имеются файлы конфигурации: `tasks.json`, `launch.json` и
> `c_cpp_properties.json`. Они содержат вспомогательные настройки для IDE -
> таски, конфигурации отладчика и т.д.

Для автоматизации работы используются скрипты. Краткое введение в скрипты:

1. Запускаем `./dev/setup.sh` когда только приступили к работе, либо удалили
  предыдущие созданные файлы (начинаем заново)
1. Делаем изменения в коде
2. Запускаем сборку БД через `./dev/build.sh`
3. Запускаем тесты через `./dev/test.sh --regress` - проверяем, что ничего не
   сломали
4. Создаем и запускаем БД - `./dev/run.sh --init-db --run-db`
5. Запускаем PSQL - `./dev/run.sh --psql`
6. Ставим где нужно точки останова, запускаем отладчик (F5) и вводим PID нашего
   бэкэнда (высветился в PSQL)
7. Запускаем скрипт, дебажим, завершаем работу, делаем изменения, опять собираем
8. После работы можно очистить созданные файлы - `./dev/clean.sh --build`

Также есть множество тасок для VS Code (из `.vscode/launch.json`).
Эти шаги можно выполнить с помощью тасок следующим образом:

1. Запускаем таску `Setup` для настройки окружения
2. Делаем изменения в коде
3. Запускаем сборку БД через таску `Build`, либо сочетанием клавиш `Ctrl + Shift + B`
4. Запускаем тесты через таску `Test regress`, либо сочетанием клавиш `Ctrl + Shift + T`
5. Создаем и запускаем БД - таска `Run DB`
6. Запускаем PSQL - таска `Run psql`
7. Ставим где нужно точки останова, запускаем отладчик (F5) и вводим PID нашего
   бэкэнда (высветился в PSQL)
8. Запускаем скрипт, дебажим, завершаем работу, делаем изменения, опять собираем
9. После работы можно очистить созданные файлы - таска `Clean build`

> Для ускорения запуска тасок можно забиндить команду `Tasks: Run Task`.
> Например, `Alt + T`. После этого, можно запускать нужные таски быстрее
